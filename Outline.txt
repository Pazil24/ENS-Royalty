6**Starter Outline for â€œENS Royaltyâ€**.

---

# âœ… **Recommended Folder Structure (Inside Scaffold-ETH Monorepo)**

Scaffold-ETH 2 uses a PNPM monorepo.
Your project can follow:

```
packages/
   contracts-ens-royalty/      <-- all solidity & hardhat code
   subgraph-ens-royalty/       <-- The Graph subgraph
   ui/                         <-- leave untouched for now
```

This gives you:

### **1. packages/contracts-ens-royalty**

* NameWrapper extension contract
* Subdomain minting + royalty %
* Payment splitter
* Events for The Graph
* Hardhat scripts
* Tests

### **2. packages/subgraph-ens-royalty**

* schema.graphql
* mappings.ts
* Entities for:

  * RoyaltyConfigured
  * SubdomainMinted
  * RoyaltyPaid
* Dockerized local graph node optional
* Deployment scripts

### **3. packages/ui (existing Scaffold-ETH UI)**

* No modifications needed for now
* Use built-in contract interaction UI for testing

---

# âš¡ Now, here is your **README.md** (only for the first 3 features + subgraph, UI untouched)

---

# **ENS Royalty â€” Programmable ENS Revenue Infrastructure**

*â€œRoyalties baked into ENS names.â€*

ENS Royalty introduces **programmable revenue splits** directly inside ENS names using **NameWrapper**, royalty logic, and on-chain payment splitting. Subdomains minted under a parent domain automatically share revenue (sales, renewals, transfers, or protocol revenues), creating a trustless royalty layer for brands, creators, and affiliate networks.

This repository contains the backend components of the ENS Royalty MVP built with **Scaffold-ETH 2**.

---

## ğŸ“ **Monorepo Structure**

```
packages/
â”‚
â”œâ”€ contracts-ens-royalty/      # NameWrapper extension + royalty logic
â”‚
â”œâ”€ subgraph-ens-royalty/       # The Graph indexing royalty events
â”‚
â””â”€ ui/                         # Default Scaffold-ETH UI (not modified)
```

---

# ğŸš€ Features (Phase 1 MVP)

### **1. NameWrapper Royalty Extension**

Adds royalty logic into ENS NameWrapper through:

* ERC-1155 transfer hooks
* Custom permission bits (fuses)
* Immutable royalty rules once fused ("locked")
* Royalty events emitted for The Graph

### **2. Subdomain Minting with Royalty %**

* Mint subdomains under any wrapped parent
* Set royalty percentage (1â€“20%)
* Burn fuse to permanently lock royalty rules
* Emits `SubdomainMinted` and `RoyaltyConfigured`

### **3. Payment Splitter**

For demo simplicity:

* On-chain royalty distribution triggered manually (`distributeRoyalties()`)
* Splits revenue:

  * 90% â†’ subdomain owner
  * 10% â†’ parent domain (or custom %)
* Supports ETH for MVP (ERC20 optional later)

### **4. The Graph Subgraph**

Indexes:

* Subdomain mints
* Royalty configurations
* Royalty payments
* Ownership changes

Provides:

* Real-time royalty history
* Revenue analytics
* Parent-child hierarchy explorer

---

# ğŸ› ï¸ **packages/contracts-ens-royalty**

### **Whatâ€™s Included**

* `RoyaltyNameWrapper.sol` â€” main extension logic
* `ENSRoyaltyManager.sol` â€” stores royalty config
* `SubdomainFactory.sol` â€” minting with royalty rules
* `RoyaltyPaymentSplitter.sol` â€” handles payout
* Hardhat config + deployment scripts
* Unit test suite

---

# ğŸ“Š **packages/subgraph-ens-royalty**

### **Entities**

* **RoyaltyConfigured**
* **SubdomainMinted**
* **RoyaltyPaid**
* **NameOwnershipChanged**

### **Files**

* `schema.graphql`
* `mappings.ts`
* `subgraph.yaml`

### **Queries**

* Fetch all subdomains under a domain
* Get royalty % for any name
* History of all royalty payouts
* Revenue earned by a parent domain

---

# â–¶ï¸ Getting Started

### **Install PNPM**

```
npm install -g pnpm
```

### **Install All Dependencies**

```
pnpm install
```

---

# âš™ï¸ Deploy Contracts

```
cd packages/contracts-ens-royalty
pnpm hardhat deploy --network localhost
```

After deployment, scaffold-eth automatically loads contract ABIs into the UI.

---

# ğŸ“¡ Run Local Graph Node (optional)

```
cd packages/subgraph-ens-royalty
graph codegen
graph build
graph deploy --studio ens-royalty
```

---

# ğŸ§ª Test in Scaffold-ETH UI

Open dev mode:

```
pnpm dev
```

Use the built-in contract interaction interface to:

* Wrap parent ENS name
* Mint a subdomain
* Set royalty %
* Burn fuse to lock royalty
* Trigger a payment split
* View events indexed by The Graph

---

# ğŸ¬ Example Demo Flow (for hackathon)

1. **Wrap parent domain** â†’ `demo.eth`
2. **Mint `artist.demo.eth`** with 10% royalty
3. **Lock royalty rule** (burn fuse)
4. Simulate revenue (call `sendRevenue(1 ETH)`)
5. Call `distributeRoyalties()`
6. Watch 0.9 ETH â†’ artist, 0.1 ETH â†’ parent
7. Try to modify royalty â†’ reverts (as expected)
8. Query The Graph â†’ display indexed payout events

---

# ğŸ“„ License

MIT

---